(function(e){"use strict";e.Ghostbin=function(){var e;var t;return{formatDuration:function(e){e=e|0;if(e<60){return""+e+"s"}else if(e<3600){return""+(e/60|0)+"m"+(e%60|0)+"s"}else{return""+(e/3600|0)+"h"+(e%3600/60|0)+"m"+(e%60|0)+"s"}},loadLanguages:function(){var n={more:false,results:[]};var a={};$.ajax({url:"/languages.json",async:false,dataType:"json",cache:true,success:function(e){$.each(e,function(e,t){var i=t;i.text=t.name;i.children=t.languages;$.each(t.languages,function(e,t){t.text=t.name;a[t.id]=t;if(t.alt_ids){$.each(t.alt_ids,function(e,n){a[n]=t})}});n.results.push(i)})}});t=a;e=n;return},languagesForSelect2:function(){return e},languageNamed:function(e){if(typeof e==="undefined")return undefined;return t[e]},defaultLanguage:function(){return this.languageNamed(this.getPreference("defaultLanguage"))},setDefaultLanguage:function(e){this.setPreference("defaultLanguage",e.id)},clearDefaultLanguage:function(){this.clearPreference("defaultLanguage")},defaultExpiration:function(){return this.getPreference("defaultExpiration","-1")},setDefaultExpiration:function(e){this.setPreference("defaultExpiration",e)},clearDefaultExpiration:function(){this.clearPreference("defaultExpiration")},setPreference:function(e,t){localStorage[e]=t},getPreference:function(e,t){return localStorage[e]||t},clearPreference:function(e){delete localStorage[e]},updatePartial:function(e){$.ajax({type:"GET",url:"/partial/"+e,async:false,dataType:"html",success:function(t){$("#partial_container_"+e).html(t)}})},_loginReplyHandler:function(e){$("#partial_container_login_logout .blocker").fadeOut("fast");switch(e.status){case"valid":$("#login_error").text("").hide(400);if(e.type==="persona"){Ghostbin.setPreference("persona",e.extra.persona)}Ghostbin.updatePartial("login_logout");break;case"moreinfo":$("#login_error").text("").hide(400);if(typeof e.invalid_fields!=="undefined"){$.each(e.invalid_fields,function(e,t){var n=$("form#loginForm input[name="+t+"]");n.parents(".control-group").eq(0).show(400);n.focus()})}break;case"invalid":if(typeof e.invalid_fields!=="undefined"){$.each(e.invalid_fields,function(e,t){$("form#loginForm input[name="+t+"]").parents(".control-group").eq(0).addClass("error")})}if(typeof e.reason!=="undefined"){$("#login_error").text(e.reason).show(400)}break}},login:function(e){$("#partial_container_login_logout .blocker").fadeIn("fast");$("form#loginForm .control-group").removeClass("error");$.ajax({type:"POST",url:"/auth/login",async:true,dataType:"json",data:e,success:Ghostbin._loginReplyHandler,error:function(){$("#partial_container_login_logout .blocker").fadeOut("fast");navigator.id.logout()}})},logout:function(){$("#partial_container_login_logout .blocker").fadeIn("fast");$.ajax({type:"POST",url:"/auth/logout",async:true,success:function(){$("#partial_container_login_logout .blocker").fadeOut("fast");if(Ghostbin.getPreference("persona",null)){navigator.id.logout();Ghostbin.clearPreference("persona")}Ghostbin.updatePartial("login_logout")},failure:function(e){$("#partial_container_login_logout .blocker").fadeOut("fast");alert(e)}})}}}()})(window);$(function(){"use strict";var e=$("#pasteForm");var t=$("#code"),n=$("#code-editor");if(e.length>0){var a=e.find("#langbox");var i=e.data("context");Ghostbin.loadLanguages();a.select2({data:Ghostbin.languagesForSelect2(),matcher:function(e,t,n){if(!n.id)return false;if(n.name.toUpperCase().indexOf((""+e).toUpperCase())>=0)return true;if(n.id.toUpperCase().indexOf((""+e).toUpperCase())>=0)return true;for(var a in n.alt_ids){if(n.alt_ids[a].toUpperCase().indexOf((""+e).toUpperCase())>=0)return true}return false}});var o=Ghostbin.languageNamed(a.data("selected"))||Ghostbin.defaultLanguage()||Ghostbin.languageNamed("text");a.select2("data",o);if(i==="new"){e.find("input[name='expire']").val(Ghostbin.defaultExpiration());var r=$("#optionsModal");r.modal({show:false});r.find("input[type='checkbox']").on("change",function(){Ghostbin.setPreference($(this).data("gb-key"),this.checked?"true":"false")}).each(function(){this.checked=Ghostbin.getPreference($(this).data("gb-key"),"false")==="true"});$("#optionsButton").on("click",function(){r.modal("show")})}e.on("submit",function(){if((n.val().match(/[^\s]/)||[]).length!==0){if(i==="new"){if(Ghostbin.getPreference("saveExpiration","false")==="true"){Ghostbin.setDefaultExpiration(e.find("input[name='expire']").val())}else{Ghostbin.clearDefaultExpiration()}if(Ghostbin.getPreference("saveLanguage","false")==="true"){Ghostbin.setDefaultLanguage(a.select2("data"))}else{Ghostbin.clearDefaultLanguage()}}e.find("input[name='title']").val($("#editable-paste-title").text())}else{$("#deleteModal, #emptyPasteModal").modal("show");return false}});$("#editable-paste-title").keypress(function(e){if(e.which==13){$(n).focus();return false}return true})}(function(){var e=$("#paste-controls");if(e.length===0)return;e.onMediaQueryChanged("screen and (max-width: 767px)",function(e){this.detach();var t;if(e.matches){t=$("#phone-paste-control-container")}else{t=$("#desktop-paste-control-container")}t.prepend(this)})})();(function(){var t=$("#encryptModal");if(t.length===0)return;t.modal({show:false});var n=t.find("input[type='password']"),a=e.find("input[name='password']");n.keypress(function(e){if(e.which===13){t.modal("hide");return false}});var i=function(e){$("#encryptionIcon").removeClass("icon-lock icon-lock-open-alt").addClass(e?"icon-lock":"icon-lock-open-alt");$("#encryptionButton .button-data-label").text(e?"On":"")};t.on("show",function(){n.val(a.val())}).on("shown",function(){$(this).find("input").eq(0).focus().select()}).on("hidden",function(){a.val(n.val());i($(this).find("input").val().length>0)});$("#encryptionButton").on("click",function(){t.modal("show")})})();(function(){var t=$("#expireModal");if(t.length===0)return;t.modal({show:false});var n=e.find("input[name='expire']");var a=$("#expirationButton .button-data-label");var i=function(){$(this).button("toggle");n.val($(this).data("value"));a.text($(this).data("display-value"))};i.call(t.find("button[data-value='"+n.val()+"']"));t.find("button[data-value]").on("click",function(){i.call(this);t.modal("hide")});$("#expirationButton").on("click",function(){t.modal("show")})})();var l=$("#line-numbers");(function(){if(l.length===0)return;if(t.length>0){var e=$(document.createElement("div")).addClass("line-highlight-bar").hide().appendTo("body");var a=e.clone().addClass("line-highlight-bar-permanent").appendTo("body");var i=function(e){e.css("left",l.outerWidth()).css("top",$(this).position().top+$(this).parent().position().top).width(t.outerWidth()).show()};var o=function(e){if(typeof e!=="undefined"){a.data("cur-line",e);history.replaceState({line:e},"","#L"+e)}else{a.removeData("cur-line");history.replaceState(null,"","#")}};var r=function(e){if(!e)return undefined;var t=e.match(/^#L(\d+)/);if(typeof t!=="undefined"&&t.length>0){return t[1]}return undefined};l.fillWithLineNumbers((t.text().match(/\n/g)||[]).length+1,function(){l.children().mouseenter(function(){i.call(this,e)}).mouseleave(function(){e.hide()}).click(function(){var e=$(this).text();if(0+a.data("cur-line")===e){o(undefined);a.hide();return}o(e);i.call(this,a)});$(window).on("load popstate",function(){var e=r(window.location.hash);if(e){var t=$("span:nth-child("+e+")",l);if(t.length>0){o(e);i.call(t.get(0),a);t.scrollMinimal()}}})});$(window).on("resize",function(){$(e).width(t.outerWidth());$(a).width(t.outerWidth())});$(document).on("media-query-changed",function(){i.call($("span:nth-child("+a.data("cur-line")+")",l).get(0),a)})}else if(n.length>0){n.on("input propertychange",function(){l.fillWithLineNumbers((n.val().match(/\n/g)||[]).length+1,function(){$(".textarea-height-wrapper").css("left",l.outerWidth())})}).triggerHandler("input");$(document).on("media-query-changed",function(){n.triggerHandler("input")})}})();(function(){if(n.length>0){n.keydown(function(e){if(e.keyCode===9&&!e.ctrlKey&&!e.altKey&&!e.shiftKey){var t=[this.selectionStart,this.selectionEnd];this.value=this.value.substring(0,t[0])+"	"+this.value.substring(t[1],this.value.length);this.selectionStart=this.selectionEnd=t[0]+1;return false}})}})();$("[autofocus]:not(:focus)").eq(0).focus();$("[title]").tooltip({trigger:"hover",placement:"bottom",container:"body",delay:{show:250,hide:50}});var u=Math.floor((new Date).getTime()/1e3);$("#expirationIcon").tooltip({trigger:"hover",placement:"bottom",container:"body",title:function(){var e=0+$(this).data("reftime");var t=Math.floor((new Date).getTime()/1e3);var n=u-e;var a=0+$(this).data("value")+n-t;if(a>0){return"Expires in "+window.Ghostbin.formatDuration(a)}else{var i=Math.random();return i<=.5?"Wha-! It's going to explode! Get out while you still can!":"He's dead, Jim."}},delay:{show:250,hide:50}});navigator.id.watch({loggedInUser:Ghostbin.getPreference("persona",null),onlogin:function(e){var t=$("#loginForm").serializeObject();t["type"]="persona";t["assertion"]=e;Ghostbin.login(t)},onlogout:function(){Ghostbin.logout()}})});